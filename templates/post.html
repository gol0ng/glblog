{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ super() }}{% endblock %}

{% block content %}
    <article class="post-detail">
        <h2>{{ post.title }}</h2>
        <div class="post-meta">
            <span>作者：{{ post.author }} | 日期：{{ post.created_date.strftime('%Y-%m-%d') }}</span>
            {% if post.tags %}
            <span class="tags">标签:
                {% for tag in post.tags.split(', ') %}
                    <a href="{{ url_for('tag', tag_name=tag) }}">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </span>
            {% endif %}
        </div>

        <div class="post-content">
            {{ post_content|safe }}
        </div>

        {% if session.logged_in and session.is_admin %}
            <div class="admin-actions">
                <a href="{{ url_for('edit', post_id=post.id) }}" class="edit-btn">编辑</a>
                <form action="{{ url_for('delete', post_id=post.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="delete-btn" onclick="return confirm('确定要删除这篇文章吗？');">删除</button>
                </form>
            </div>
        {% endif %}

        <a href="{{ url_for('index') }}" class="back-link">&larr; 返回列表</a>
    </article>
<script>
// 图片点击放大/缩小功能
document.querySelectorAll('.post-content img').forEach(img => {
    // 标记大图
    if(img.naturalWidth > 800 || img.naturalHeight > 600) {
        img.classList.add('large-image');
    }

    // 点击事件
    img.addEventListener('click', function() {
        this.classList.toggle('zoomed');
    });
});

// 点击空白处关闭放大的图片
document.addEventListener('click', function(e) {
    if(e.target.classList.contains('zoomed')) {
        e.target.classList.remove('zoomed');
    }
});
</script>
{% endblock %}